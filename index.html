<!DOCTYPE html>
<html>
  <head>
    <script src="https://www.gstatic.com/realtime/realtime-client-utils.js">  </script>
    <script type="text/javascript">

const DO_NOW = new Promise((resolve, reject) => resolve());

const CLIENT_ID = '663604848714-cdppq8r1sc2sqdt7lu3nc05r4utjr0vf.apps.googleusercontent.com';
  //'835615821089-0mmun003p819e379vpurms6f1joj33qk.apps.googleusercontent.com';
const SCOPES = [
  'https://www.googleapis.com/auth/spreadsheets',
  'https://www.googleapis.com/auth/userinfo.email',
];

var rt_utils = new utils.RealtimeUtils({clientId: CLIENT_ID});

/*global*/ arghablargha = function() {
  gapi.auth.authorize({
    client_id: CLIENT_ID,
    scope: SCOPES.join(''),
    immediate: true
  }, handle_auth_result);
};

const handle_auth_result = function(auth_result) {
  const authorize_div = document.getElementById('authorize-div');
  if(auth_result && !auth_result.error) {
    authorize_div.style.display = 'none';
    start_the_application();
  } else {
    authorize_div.style.display = 'inline';
    const authorize_button = document.getElementById('authorize-button');
    authorize_button.onclick = function(_) {
      gapi.auth.authorize({
        client_id: CLIENT_ID,
        scope: SCOPES,
        immediate: false
      }, handle_auth_result);
      return false;
    };
  }
};

var start_the_application = function() {
  let email = null;
  DO_NOW.then(() => {
    const action = gapi.client.load('https://sheets.googleapis.com/$discovery/rest?version=v4');
  return action; }).then( () => {
//    const action = gapi.client.load('plus', 'v1');
//  return action; }).then( () => {
    // Look up my timesheet, in case it already exists.
    const action = gapi.client.sheets.spreadsheets.values.get({
      spreadsheetId: '1sajRfA9hYZacI-a4UH0-cgfwf1hvzpVczUwRhn2kwGY',  // A public list of all timesheets
      range: 'A1',
    });
  return action; }).then( (response) => {
    const bulletin = JSON.parse(response.result.values[0][0]);
    const file_id = bulletin[email];
    console.log(file_id);
  });

//    // Create new
//    rt_utils.createRealtimeFile('Temp', function(r) {
//      console.log(r.id);
//    });

};

    </script>
    <script src="https://apis.google.com/js/client.js?onload=arghablargha">  </script>
  </head>
  <body>
    successfully updated 3
    <br />
    <div id="authorize-div" style="display: none">
      <span>Authorize access to Drive API</span>
      <!--Button for the user to click to initiate auth sequence -->
      <button id="authorize-button">
        Authorize
      </button>
    </div>
    <pre id="output"></pre>
  </body>
</html>
